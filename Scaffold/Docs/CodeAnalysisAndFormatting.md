# Code Analysis and Formatting

The [.NET Compiler Platform (_Roslyn_)](https://github.com/dotnet/roslyn) can analyze your code for issues as you type using built-in or third-party analyzers. These analyzers are often called [_Roslyn Analyzers_](https://docs.microsoft.com/dotnet/fundamentals/code-analysis/overview) and are primarily used to help you write more maintainable code. Roslyn Analyzers can be configured by using either an [_EditorConfig_](https://docs.microsoft.com/dotnet/fundamentals/code-analysis/code-style-rule-options) file or a [_rule set_](https://docs.microsoft.com/visualstudio/code-quality/using-rule-sets-to-group-code-analysis-rules) file. Rules in the EditorConfig file override the rules the rule set file.

Scaffold uses both an EditorConfig file and a rule set file.

## Built-in Analyzers

Starting in .NET 5, the .NET SDK includes analyzers for code styling and quality issues. They do not need to be install separately. Scaffold uses an [EditorConfig file](../.editorconfig) to configure these analyzers.

- Microsoft.CodeAnalysis.Diagnostics - Provides code style analysis.
- [Microsoft.CodeAnalysis.NetAnalyzers](https://github.com/dotnet/roslyn-analyzers) - Provides code quality analysis.

## Third-party Analyzers

Scaffold uses the following third-party Roslyn Analyzers in some or all of its projects. For an analyzer to work for a given project, it must be installed in that project. To install an analyzer globally for all projects, add the analyzer to [_Directory.Build.props_](../Directory.Build.props). Scaffold uses a [rule set file](../CodeAnalysis.ruleset) to configure these analyzers.

- [IDisposableAnalyzers](https://github.com/DotNetAnalyzers/IDisposableAnalyzers) - Corrects the use of IDisposables.
- [SonarAnalyzer.CSharp](https://github.com/SonarSource/sonar-dotnet) - Helps spot bugs and code smells.
- [StyleCop.Analyzers](https://github.com/DotNetAnalyzers/StyleCopAnalyzers) - Enforce style and consistency when writing C# code.
- [xUnit.Analyzers](https://github.com/xunit/xunit.analyzers) - Helps to write better tests.

## Formatting

Many analyzer issues can be quickly fixed by using the [`dotnet format`](https://docs.microsoft.com/dotnet/core/tools/dotnet-format) tool, which formats your code to match your EditorConfig file.

Scaffold uses the default EditorConfig file generated by the `dotnet new editorconfig` command with the following settings appended.

```ini
# Scaffold - EditorConfig Overrides

# C# files
[*.cs]

# New line preferences
end_of_line = lf
insert_final_newline = true

# 'namespace' preferences
csharp_style_namespace_declarations = file_scoped:warning

# 'using' preferences
dotnet_diagnostic.IDE0005.severity = warning
dotnet_separate_import_directive_groups = false
csharp_using_directive_placement = inside_namespace:silent

# this. and Me. preferences
dotnet_style_qualification_for_event = true:silent
dotnet_style_qualification_for_field = true:silent
dotnet_style_qualification_for_method = true:silent
dotnet_style_qualification_for_property = true:silent

# Naming styles
dotnet_naming_style._camelcase.required_prefix =

# 'var' preferences
csharp_style_var_elsewhere = false:warning
csharp_style_var_for_built_in_types = false:warning
csharp_style_var_when_type_is_apparent = false:warning
csharp_style_implicit_object_creation_when_type_is_apparent = false:warning

# Expression-bodied members
csharp_style_expression_bodied_lambdas = when_on_single_line
```

## Rule References

Code Style Rules - <https://docs.microsoft.com/dotnet/fundamentals/code-analysis/style-rules>

Code Quality Rules - <https://docs.microsoft.com/dotnet/fundamentals/code-analysis/quality-rules>

Sonar Static Code Analysis Rules - <https://rules.sonarsource.com/csharp>

StyleCop.Analyzers Rules - <https://github.com/DotNetAnalyzers/StyleCopAnalyzers/blob/master/DOCUMENTATION.md>

xUnit.Analyzers Rules - <https://xunit.net/xunit.analyzers/rules>
